# RustDesk 命令行参数说明

基于 `core_main.rs` 源码分析生成

## 版本信息

| 参数 | 说明 | 返回值 |
|------|------|--------|
| `--version` | 显示程序版本号 | 打印版本号后退出 |
| `--build-date` | 显示程序构建日期 | 打印构建日期后退出 |

## 服务相关

| 参数 | 说明 | 权限要求 |
|------|------|----------|
| `--service` | 以服务模式启动 | - |
| `--install-service` | 安装系统服务 | - |
| `--uninstall-service` | 卸载系统服务 | - |
| `--server` | 启动服务器模式 | - |
| `--no-server` | 不启动服务器 | - |
| `--tray` | 启动系统托盘 | - |

## 安装/卸载 (Windows)

| 参数 | 说明 | 权限要求 |
|------|------|----------|
| `--install` | 安装程序 | 管理员 |
| `--noinstall` | 清除安装参数 | - |
| `--silent-install` | 静默安装（包含桌面图标、开始菜单、打印机） | 管理员 |
| `--uninstall` | 卸载程序 | 管理员 |
| `--after-install` | 安装后执行的操作 | - |
| `--before-uninstall` | 卸载前执行的操作 | - |
| `--update` | 更新程序 | 管理员 |
| `--remove <path>` | 删除指定文件 | - |

## 快速支持/便携模式 (Windows)

| 参数 | 说明 | 适用场景 |
|------|------|----------|
| `--quick_support` | 快速支持模式 | 未安装时自动启用便携式服务 |
| `--portable-service` | 便携服务模式 | 提升权限或以系统用户运行便携服务 |
| `--elevate` | 提升权限运行 | 配合快速支持模式使用 |
| `--run-as-system` | 以系统用户运行 | 配合快速支持模式使用 |

## 驱动/组件管理 (Windows)

| 参数 | 说明 | 权限要求 |
|------|------|----------|
| `--install-idd` | 安装/更新虚拟显示驱动 | 管理员 |
| `--uninstall-amyuni-idd` | 卸载 Amyuni IDD 驱动 | 管理员 |
| `--install-remote-printer` | 安装远程打印机 (需要 Win10+) | 管理员 |
| `--uninstall-remote-printer` | 卸载远程打印机 | 管理员 |
| `--uninstall-cert` | 卸载证书 | 管理员 |

## 远程连接 (Flutter)

| 参数 | 说明 | 配合参数 |
|------|------|----------|
| `--connect <id>` | 连接到指定 ID 的远程桌面 | --password, --relay |
| `--play <id>` | 播放模式连接 | --password, --relay |
| `--file-transfer <id>` | 文件传输模式连接 | --password, --relay |
| `--view-camera <id>` | 查看远程摄像头 | --password, --relay |
| `--port-forward <id>` | 端口转发连接 | --password, --relay |
| `--rdp <id>` | RDP 远程桌面连接 | --password, --relay |
| `--password <pwd>` | 指定连接密码（配合上述连接命令使用） | - |
| `--relay` | 强制使用中继服务器连接 | - |
| `--switch_uuid <uuid>` | 切换 UUID（内部参数） | - |

> **注意**：这些连接参数会尝试通过 D-Bus (Linux) / Window Message (Windows) / URL Scheme (macOS) 发送到已运行的实例，如果发送失败则启动新实例。

## 配置管理

| 参数 | 说明 | 权限要求 |
|------|------|----------|
| `--import-config <path>` | 导入配置文件 | - |
| `--config <name>` | 从加密字符串设置自定义服务器配置 | 管理员+已安装 |
| `--option <key>` | 获取配置项值 | 管理员+已安装 |
| `--option <key> <value>` | 设置配置项值 | 管理员+已安装 |

## ID/密码管理

| 参数 | 说明 | 权限要求 |
|------|------|----------|
| `--get-id` | 获取当前设备 ID | - |
| `--set-id <id>` | 设置设备 ID | 管理员+已安装 |
| `--password <pwd>` | 设置永久密码 | 管理员+已安装 |
| `--set-unlock-pin <pin>` | 设置解锁 PIN | 管理员+已安装 |

## 设备分配 (需要 API Server)

使用 `--assign` 将设备分配到用户/策略/地址簿/设备组，至少需要指定其中一个目标参数。

| 参数 | 说明 | 权限要求 | 必需 |
|------|------|----------|------|
| `--assign` | 分配设备（需配合 --token 和至少一个目标参数） | 管理员+已安装 | 是 |
| `--token <token>` | API 认证令牌 | 管理员+已安装 | 是 |
| `--user_name <name>` | 分配到指定用户 | 管理员+已安装 | 否* |
| `--strategy_name <name>` | 分配到指定策略 | 管理员+已安装 | 否* |
| `--address_book_name <name>` | 分配到指定地址簿 | 管理员+已安装 | 否* |
| `--address_book_tag <tag>` | 地址簿标签（配合 address_book_name） | 管理员+已安装 | 否 |
| `--address_book_alias <alias>` | 地址簿别名（配合 address_book_name） | 管理员+已安装 | 否 |
| `--device_group_name <name>` | 分配到指定设备组 | 管理员+已安装 | 否* |

> *注：`user_name`、`strategy_name`、`address_book_name`、`device_group_name` 至少需要指定一个

## 其他功能

| 参数 | 说明 | 平台 |
|------|------|------|
| `--cm` | 启动连接管理器（带 UI），同步选项状态 | Flutter |
| `--cm-no-ui` | 启动连接管理器（无 UI），同步选项状态 | Flutter (非 Android/iOS) |
| `--whiteboard` | 启动白板功能 | 非 Android/iOS |
| `--check-hwcodec-config` | 检查硬件编解码器配置 | 启用 hwcodec 功能时 |
| `--remove <path>` | 延迟删除指定文件（用于自删除） | 所有平台 |
| `-gtk-sudo` | GTK sudo 执行（内部使用） | Linux |

## 插件管理 (需要 plugin_framework 功能)

| 参数 | 说明 |
|------|------|
| `--plugin-install <id>` | 安装/恢复插件 | - |
| `--plugin-install <id> <url>` | 从 URL 安装插件 | - |
| `--plugin-uninstall <id>` | 卸载插件 | - |



## URI Scheme 支持

程序支持通过 URI 协议启动，格式：`rustdesk://<操作>/<ID>?<参数>`

支持的操作：`connect`、`play`、`file-transfer`、`view-camera`、`port-forward`、`rdp`

示例：
- `rustdesk://connect/123456789`
- `rustdesk://connect/123456789?password=mypass&relay=true`
- `rustdesk://file-transfer/987654321?password=secret`

## 使用示例

```bash
# 查看版本和构建日期
rustdesk --version
rustdesk --build-date

# 启动系统托盘
rustdesk --tray

# 启动服务器模式（Linux/macOS 会同时启动托盘）
rustdesk --server

# 连接到指定 ID（支持密码和中继）
rustdesk --connect 123456789 --password mypassword --relay

# 文件传输模式
rustdesk --file-transfer 123456789

# 静默安装（Windows，需要管理员权限）
rustdesk --silent-install

# 设置永久密码（需要已安装+管理员权限）
rustdesk --password mypassword

# 获取和设置设备 ID
rustdesk --get-id
rustdesk --set-id 123456789

# 设置解锁 PIN（需要已安装+管理员权限）
rustdesk --set-unlock-pin 1234

# 设置自定义服务器（需要已安装+管理员权限）
rustdesk --config encrypted_config_string

# 获取/设置配置选项（需要已安装+管理员权限）
rustdesk --option key_name
rustdesk --option key_name value

# 分配设备到用户（需要已安装+管理员权限）
rustdesk --assign --token YOUR_TOKEN --user_name john@example.com

# 分配到地址簿并设置标签和别名
rustdesk --assign --token YOUR_TOKEN --address_book_name "My Address Book" --address_book_tag "production" --address_book_alias "Server-01"

# 安装服务
rustdesk --install-service

# 卸载服务
rustdesk --uninstall-service

# 导入配置文件
rustdesk --import-config /path/to/config.toml

# 启动连接管理器
rustdesk --cm

# 启动白板
rustdesk --whiteboard
```

## 注意事项

1. **权限要求**
   - 标记为"管理员"的命令需要管理员/root 权限
   - 标记为"已安装"的命令要求程序已正式安装
   - Windows 上通过 `is_elevated()` 或 `is_root()` 检查权限

2. **平台差异**
   - 部分功能仅在特定操作系统可用（Windows、macOS、Linux）
   - 远程打印机功能需要 Windows 10 或更高版本
   - 某些驱动安装功能仅限 Windows 平台

3. **启动行为**
   - **无参数启动**：启动 GUI 界面并在后台启动服务器
   - **安装检测**：Windows 上会检测是否为安装包（setup），自动添加 `--install` 参数
   - **快速支持自动检测**：未安装且文件名包含 `-qs-` 或满足其他条件时自动启用快速支持模式

4. **连接参数路由**
   - Linux: 通过 D-Bus 发送到已运行实例
   - Windows: 通过 Window Message 发送
   - macOS: 通过 URL Scheme IPC 发送
   - 发送失败时启动新实例处理

5. **配置文件**
   - `--import-config` 支持导入 `.toml` 和 `2.toml` 两个配置文件
   - 配置导入会检查文件修改时间，避免覆盖较新的配置

6. **设备分配**
   - 需要配置 API Server
   - 请求发送到 `{api-server}/api/devices/cli`
   - 设备必须可注册（非 `no_register_device` 模式）

7. **插件管理**
   - 仅在启用 `plugin_framework` 功能且已安装时加载插件
   - `--server` 模式会初始化插件
   - `--service` 模式会移除已卸载的插件

8. **托盘自动启动**
   - Linux/Windows: 当检测到 `--server` 进程运行但无 `--tray` 进程时自动启动托盘
   - macOS: `--server` 模式会直接启动托盘

## 参数分类速查

| 分类 | 主要参数 | 用途 |
|------|----------|------|
| **信息查询** | `--version`, `--build-date`, `--get-id` | 查看版本、ID 等信息 |
| **服务管理** | `--service`, `--server`, `--install-service`, `--uninstall-service` | 系统服务相关操作 |
| **安装/更新** | `--install`, `--silent-install`, `--uninstall`, `--update` | 程序安装、卸载、更新 |
| **远程连接** | `--connect`, `--file-transfer`, `--rdp` 等 | 发起远程连接 |
| **配置管理** | `--config`, `--option`, `--import-config` | 配置相关操作 |
| **ID/密码** | `--set-id`, `--password`, `--set-unlock-pin` | ID 和密码管理 |
| **设备分配** | `--assign` 及相关参数 | 将设备分配到用户/组 |
| **驱动组件** | `--install-idd`, `--install-remote-printer` 等 | 驱动和组件安装 |
| **UI 功能** | `--tray`, `--cm`, `--whiteboard` | 界面相关功能 |
| **插件管理** | `--plugin-install`, `--plugin-uninstall` | 插件操作 |

---

**文档版本**: 基于 `core_main.rs` 源码分析  
**更新日期**: 2025-10-13
