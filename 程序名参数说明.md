# RustDesk 程序名参数说明

RustDesk 支持通过程序文件名传递启动参数，无需使用命令行参数即可触发特定功能。

## 支持的文件名参数

### 1. 安装模式 (`install.exe`)

**文件名格式**: `*install.exe`

**功能**: 当程序名以 `install.exe` 结尾且不带任何命令行参数时，自动进入安装模式

**示例**:
- `rustdesk-install.exe`
- `myapp-install.exe`

**效果**: 等同于运行 `rustdesk.exe --install`

---

### 2. 快速支持模式 (`-qs-` 或 `qs.exe`)

**文件名格式**: 
- 包含 `-qs-` 的任意位置（Windows）
- 或以 `qs.exe` 结尾（便携版）

**功能**: 启用快速支持模式，适用于临时远程协助场景

**示例**:
- `rustdesk-qs-2024.exe`
- `app-qs-support.exe`
- `quicksupport-qs.exe`
- `rustdesk-qs.exe`（便携版）

**触发条件**（Windows）:
- 程序未安装
- 无命令行参数
- 文件名包含 `-qs-`（不区分大小写）
- 或配置中 `pre-elevate-service` 选项为 `Y`
- 或程序以提升权限运行

---

### 3. 自定义服务器配置（加密配置）

**文件名格式**: `*--<加密字符串>--.exe`

**功能**: 通过文件名嵌入自定义服务器配置（需要密钥签名或Base64编码）

**示例**:
- `rustdesk--abc123xyz--.exe`
- `rustdesk--licensed--config--abc.exe`
- `rustdesk--licensed---doubleconfig.exe`

**配置数据**: JSON格式，包含以下字段
```json
{
  "key": "服务器密钥",
  "host": "中继服务器地址",
  "api": "API服务器地址",
  "relay": "中继服务器地址"
}
```

**注意**: 
- 配置字符串需要Base64 URL-safe编码并可选地用签名密钥加密
- 支持 `--licensed--`、`--licensed---` 等变体格式
- 也支持括号分隔的多配置：`config1(config2).exe`

---

### 4. 自定义服务器配置（明文格式）

**文件名格式**: `*host=<服务器地址>[,key=<密钥>][,api=<API>][,relay=<中继>].exe`

**功能**: 以明文格式在文件名中配置自定义服务器

**示例**:
```
rustdesk-host=rs.example.com,key=abc123,api=https://api.example.com.exe
myapp-host=server.com,relay=relay.example.com.exe
app-host=192.168.1.100,key=mykey123,api=https://api.local.exe
```

**参数说明**:
- `host=` - 中继服务器地址（必需）
- `key=` - 服务器密钥（可选）
- `api=` - API服务器地址（可选）
- `relay=` - 中继服务器地址（可选）

**特性**:
- 参数用逗号 `,` 分隔
- 参数顺序不限，但 `host=` 建议放在最前面
- 不区分大小写
- Windows 重命名添加的 `(1)`, `(2)` 等后缀不会影响解析

---

## 实现原理

### 检测逻辑

程序启动时会检查 `args[0]`（程序自身路径），并根据文件名触发相应功能：

1. **安装模式检测** (core_main.rs:118)
   ```rust
   let click_setup = cfg!(windows) && args.is_empty() && crate::common::is_setup(&arg_exe);
   ```

2. **快速支持模式检测** (core_main.rs:139)
   ```rust
   _is_quick_support |= !crate::platform::is_installed()
       && args.is_empty()
       && (arg_exe.to_lowercase().contains("-qs-")
           || config::LocalConfig::get_option("pre-elevate-service") == "Y"
           || (!click_setup && crate::platform::is_elevated(None).unwrap_or(false)));
   ```

3. **自定义服务器配置** (core_main.rs:419-437)
   - 使用 `--config` 命令行参数读取文件名中的配置
   - 自动解析加密或明文配置信息

### 便携版特殊支持

便携版 (libs/portable) 同样支持文件名参数：

- `*install.exe` → 触发安装模式
- `*qs.exe` → 触发快速支持模式

---

## 使用场景

### 场景1: 制作快速支持工具
将程序重命名为 `公司名-qs-支持工具.exe`，双击即可启动远程支持模式。

### 场景2: 分发带预配置的客户端
将程序重命名为包含服务器配置的文件名，用户无需手动配置即可连接到指定服务器：
```
rustdesk-host=rs.mycompany.com,key=abc123xyz.exe
```

### 场景3: 静默安装
将安装包命名为 `*install.exe` 并配合 `--silent-install` 参数实现自动化部署。

---

## 注意事项

1. **Windows平台专属**: 部分功能（如 `-qs-` 检测）仅在 Windows 平台有效
2. **不区分大小写**: 所有文件名检测均不区分大小写
3. **命令行参数优先**: 如果同时提供了文件名参数和命令行参数，命令行参数会覆盖文件名行为
4. **安全性**: 自定义服务器配置建议使用加密格式而非明文格式
5. **文件名长度**: Windows文件名长度限制为260字符，配置复杂服务器信息时需注意

---

## 相关代码位置

- 核心检测逻辑: `src/core_main.rs`
- 安装模式判断: `src/common.rs::is_setup()`
- 自定义服务器解析: `src/custom_server.rs::get_custom_server_from_string()`
- 便携版实现: `libs/portable/src/main.rs`

---

**生成日期**: 2025-10-13  
**版本**: 适用于 RustDesk 当前主分支
